<!-- <script src="//cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="//cdn.quilljs.com/1.3.6/quill.min.js"></script>

<link href="//cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<link href="//cdn.quilljs.com/1.3.6/quill.bubble.css" rel="stylesheet">

<link href="//cdn.quilljs.com/1.3.6/quill.core.css" rel="stylesheet">
<script src="//cdn.quilljs.com/1.3.6/quill.core.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/monokai-sublime.min.css" rel="stylesheet">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>

<div id="editor">
    <p>Hello World!</p>
    <p>Some initial <strong>bold</strong> text</p>
    <p><br></p>
</div>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script>
    var toolbarOptions = [
        ['bold', 'italic', 'underline', 'strike'],        // toggled buttons

        [{ 'list': 'ordered' }, { 'list': 'bullet' }],
        [{ 'indent': '-1' }, { 'indent': '+1' }],          // outdent/indent

        [{ 'color': [] }],          // dropdown with defaults from theme
        [{ 'align': [] }],

        ['clean'],                                         // remove formatting button
        ['code-block', 'image', 'link'],
    ];


    hljs.initHighlightingOnLoad();
    hljs.configure({ 
        languages: ['javascript', 'python', 'c++', 'golang', 'php', 'c', 'rust', 'java']
    });

    var options = {
        // debug: 'info',
        modules: {
            history: {
                delay: 2000,
                maxStack: 500,
                userOnly: true
            },
            // handlers: {
            //     // handlers object will be merged with default handlers object
            //     'link': function (value) {
            //         if (value) {
            //             var href = prompt('Enter the URL');
            //             this.quill.format('link', href);
            //         } else {
            //             this.quill.format('link', false);
            //         }
            //     }
            // },
            syntax: true,
            toolbar: toolbarOptions,
        },
        placeholder: 'Compose an epic...',
        // readOnly: true,
        theme: 'snow'
    };
    var editor = new Quill('#editor', options);

    editor.on('text-change', function (delta, oldDelta, source) {
        if (source === 'api') {
            console.log("An API call triggered this change.");
        } else if (source === 'user') {
            var delta = editor.getContents();
            console.log(delta)

            var text = editor.getText();
            console.log(text)
        }
    });


</script> -->


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>bootstrap4</title>
    <script src="login_register/vendor/jquery/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.12/summernote-bs4.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.12/summernote-bs4.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-148651561-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'UA-148651561-1');
    </script>
</head>

<body>
    <button id="edit" class="btn btn-primary" onclick="edit()" type="button">Edit 1</button>
    <button id="save" class="btn btn-primary" onclick="save()" type="button">Save 2</button>
    <div id="summernote"></div>
</body>

</html>

<script>
    var options = {
        focus: true,
        placeholder: 'Text (optional)',
        tabsize: 2,
        height: 400,
        callbacks: {
            onImageUpload: function (files) {
                // $summernote.summernote('insertNode', imgNode)
                let formData = new FormData()
                formData.append('file', files[0]);
                sendFile(formData)
            }
        },
        hint: {
            match: /:([\-+\w]+)$/,
            search: function (keyword, callback) {
                callback($.grep(emojis, function (item) {
                    return item.indexOf(keyword) === 0;
                }));
            },
            template: function (item) {
                var content = emojiUrls[item];
                return '<img src="' + content + '" width="20" /> :' + item + ':';
            },
            content: function (item) {
                var url = emojiUrls[item];
                if (url) {
                    return $('<img />').attr('src', url).css('width', 20)[0];
                }
                return '';
            }
        },
        toolbar: [
            ['style', ['bold', 'italic', 'underline', 'forecolor']],
            ['para', ['ul', 'ol', 'paragraph']],
            ['height', ['height']],
            ['insert', ['link', 'picture']],
            ['view', ['undo', 'redo', 'help']],
        ],
    }

    function sendFile(files) {
        console.log(files)

        let params = JSON.stringify({
            img: files,
        })

        let Http = new XMLHttpRequest();
        Http.open("POST", 'http://localhost:3001/upload_image', true);
        Http.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
        Http.send(params);
        Http.onreadystatechange = (e) => {
            if (Http.readyState === 4 && Http.status === 200) {
                let response = JSON.parse(Http.responseText)
                console.log(response)

                // $summernote.summernote('insertImage', response, function ($image) {
                //     $image.attr('src', response);
                // });
            }
        }
    }

    $('#summernote').on('summernote.image.upload', function (we, files) {
        console.log("wefwe")
        $summernote.summernote('insertNode', imgNode);
    })

    // // summernote.image.upload
    // $('#summernote').on('summernote.image.upload', function(we, files) {
    //     // upload image to server and create imgNode...
    //     $summernote.summernote('insertNode', imgNode);
    // })

    // if ($('#summernote').summernote('isEmpty')) {
    //     console.log("empty")
    // }

    // $('#summernote').summernote('pasteHTML', HTMLstring)


    $('#summernote').summernote(options);


    var save = function () {
        console.log($('#summernote').summernote('code'))
    }

    let Http = new XMLHttpRequest();
    Http.open("GET", 'https://api.github.com/emojis', true);
    Http.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
    Http.send();
    Http.onreadystatechange = (e) => {
        if (Http.readyState === 4 && Http.status === 200) {
            let response = JSON.parse(Http.responseText)
            window.emojis = Object.keys(response);
            window.emojiUrls = response;
        }
    }
</script>